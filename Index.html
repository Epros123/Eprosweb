<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Browser</title>
<style>
:root {
  --glass-bg: rgba(255,255,255,0.25);
  --glass-border: rgba(255,255,255,0.35);
  --ruler-color: rgba(0,122,255,0.5);
}
html, body { margin:0; height:100%; font-family:-apple-system,BlinkMacSystemFont,system-ui; background:#0f0f0f; }
#topbar { display:flex; gap:8px; padding:10px; background:rgba(30,30,30,0.75); backdrop-filter:blur(20px); }
#urlInput { flex:1; padding:10px; border-radius:10px; border:none; font-size:16px; }
button { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600; background: rgba(255,255,255,0.1); color:white; }
#tabs { display:flex; gap:6px; padding:6px; background: rgba(40,40,40,0.7); backdrop-filter: blur(20px);}
.tab { display:flex; gap:6px; align-items:center; padding:6px 10px; border-radius:10px; background: rgba(255,255,255,0.15); color:white; cursor:pointer; max-width:160px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.tab.active { background: rgba(255,255,255,0.35); }
.tab span { color:#ff6b6b; cursor:pointer; }
#content { height:calc(100% - 120px); }
iframe { width:100%; height:100%; border:none; }
#ruler { position:fixed; top:140px; left:40px; width:320px; height:48px; background: var(--ruler-color); backdrop-filter: blur(25px) saturate(180%); border:1px solid var(--glass-border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.25); display:none; resize:both; overflow:auto; cursor:move; z-index:9999; color:white; font-weight:600; text-align:center; line-height:48px;}
#settings { position:fixed; right:20px; top:140px; width:280px; padding:14px; background: rgba(30,30,30,0.85); backdrop-filter: blur(25px); border-radius:16px; color:white; display:none; z-index:9999; }
#settings label { font-size:14px; display:block; margin-top:10px; }
#settings input, #settings select { width:100%; margin-top:4px; }
</style>
</head>
<body>

<div id="topbar">
  <input id="urlInput" placeholder="Enter URL or search..." />
  <button onclick="go()">Go</button>
  <button id="rulerBtn" onclick="toggleRuler()">Ruler</button>
  <button onclick="toggleSettings()">Settings</button>
</div>

<div id="tabs"></div>
<div id="content"></div>
<div id="ruler"></div>

<div id="settings">
  <strong>Settings</strong>
  <label>Default Search Engine</label>
  <select id="searchEngine">
    <option value="bing">Bing</option>
    <option value="wikipedia">Wikipedia</option>
    <option value="duckduckgo">DuckDuckGo</option>
  </select>
  <label>Ruler Colour</label>
  <input type="color" onchange="setRulerColor(this.value)" value="#007AFF">
  <label>Ruler Opacity</label>
  <input type="range" min="0.1" max="0.8" step="0.05" onchange="setRulerOpacity(this.value)" value="0.5">
  <button style="margin-top:12px;width:100%;" onclick="resetRuler()">Reset Ruler</button>
</div>

<script>
let tabs = [];
let activeTab = null;
const ruler = document.getElementById("ruler");
let dragging=false, ox, oy;
const rulerBtn = document.getElementById("rulerBtn");
let hintTimeout=null;

// Load saved tabs
if(localStorage.getItem("savedTabs")) {
  const saved = JSON.parse(localStorage.getItem("savedTabs"));
  saved.forEach(t => createTab(t.url, t.title));
}

function isURL(text){ return text.startsWith("http://") || text.startsWith("https://"); }

function go(){
  const input=document.getElementById("urlInput").value.trim();
  if(!input) return;
  const engine=document.getElementById("searchEngine").value;
  let url;
  if(isURL(input)) url=input;
  else if(engine==="bing") url="https://www.bing.com/search?q="+encodeURIComponent(input);
  else if(engine==="duckduckgo") url="https://duckduckgo.com/html/?q="+encodeURIComponent(input);
  else if(engine==="wikipedia") url="https://en.wikipedia.org/wiki/"+encodeURIComponent(input);
  createTab(url);
}

function createTab(url, customTitle){
  if(!url) url="https://www.bing.com";
  const id=Date.now();
  const tab=document.createElement("div");
  tab.className="tab";
  tab.innerHTML=`Loading... <span>✕</span>`;
  tab.onclick=()=>activateTab(id);
  tab.querySelector("span").onclick=e=>{ e.stopPropagation(); closeTab(id); };
  document.getElementById("tabs").appendChild(tab);

  const iframe=document.createElement("iframe");
  iframe.src=url;

  iframe.onload=()=>{
    try{
      const title=customTitle || iframe.contentDocument?.title || url;
      tab.firstChild.textContent=title.length>20?title.slice(0,17)+"…":title;
      saveTabs();
    }catch{
      window.open(url,"_blank");
      closeTab(id);
    }
  };
  tabs.push({id,tab,iframe,url});
  activateTab(id);
}

function activateTab(id){
  tabs.forEach(t=>{ t.tab.classList.remove("active"); t.iframe.style.display="none"; });
  const t=tabs.find(t=>t.id===id); if(!t) return;
  t.tab.classList.add("active");
  document.getElementById("content").innerHTML="";
  document.getElementById("content").appendChild(t.iframe);
  t.iframe.style.display="block";
  activeTab=id;
}

function closeTab(id){
  const i=tabs.findIndex(t=>t.id===id); if(i===-1) return;
  tabs[i].tab.remove(); tabs[i].iframe.remove(); tabs.splice(i,1); saveTabs();
  if(tabs.length) activateTab(tabs[tabs.length-1].id);
}

function saveTabs(){
  const toSave=tabs.map(t=>({url:t.url,title:t.tab.firstChild.textContent}));
  localStorage.setItem("savedTabs",JSON.stringify(toSave));
}

// Ruler
function toggleRuler(){
  if(hintTimeout) clearTimeout(hintTimeout);
  const originalText=rulerBtn.textContent;
  rulerBtn.textContent="Click Settings to change color";
  ruler.style.display=ruler.style.display==="none"?"block":"none";
  hintTimeout=setTimeout(()=>{ rulerBtn.textContent=originalText; hintTimeout=null; },5000);
}

ruler.addEventListener("mousedown", e=>{ dragging=true; ox=e.offsetX; oy=e.offsetY; });
document.addEventListener("mousemove", e=>{ if(!dragging) return; ruler.style.left=e.pageX-ox+"px"; ruler.style.top=e.pageY-oy+"px"; });
document.addEventListener("mouseup", ()=>dragging=false);

// Settings
function toggleSettings(){ const s=document.getElementById("settings"); s.style.display=s.style.display==="none"?"block":"none"; }
function setRulerColor(color){ ruler.style.background=color+"88"; }
function setRulerOpacity(value){ ruler.style.opacity=value; }
function resetRuler(){ ruler.style.left="40px"; ruler.style.top="140px"; ruler.style.width="320px"; ruler.style.height="48px"; ruler.style.opacity="0.5"; ruler.style.background="rgba(0,122,255,0.5)"; }
</script>

</body>
</html>
